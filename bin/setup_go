#!/bin/bash
set -e

export GOPATH=$(pwd)
export PATH=$GOPATH/bin:$PATH

case `uname -a | awk '{print $1}'` in
'Linux')
  DOWNLOAD_URI="https://storage.googleapis.com/golang/go1.7.1.linux-amd64.tar.gz"
  install_go() {
    wget -O gopackage.tar.gz $DOWNLOAD_URI
    tar -xzf gopackage.tar.gz
    mv go golang
    export GOROOT=$(pwd)/golang
    export PATH=$GOPATH/bin:$GOROOT/bin:$PATH
  }
  ;;
'Darwin')
  DOWNLOAD_URI="https://storage.googleapis.com/golang/go1.7.1.darwin-amd64.pkg"
  install_go() {
    echo running brew install golang
    brew install golang
  }
  ;;
*)
  echo "Unsupported platform" >&2
  ;;
esac

# install go
install_go

mkdir -p src/github.com/cloudfoundry
ln -s /app /app/src/github.com/cloudfoundry/cf-smoke-tests

if ! command -v ginkgo >/dev/null 2>&1; then
  mkdir -p $GOPATH/src/github.com/onsi
  cp -R vendor/github.com/onsi/ginkgo $GOPATH/src/github.com/onsi/ginkgo
  go install -v github.com/onsi/ginkgo/ginkgo
fi
